<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <style>

    </style>
</head>
<body>
    <div class="container">
        <nav class="mb-3">
            <a href="./products.html" class="me-3 btn btn-primary">Productai</a>
            <a href="./admin.html" class="me-3 btn btn-primary">Admin panele</a>
        </nav>
        <form action="">
            <div class="row">
                <!-- -12 vienoje eiluteje,tie columnai kelsis i sekacnia eilute -->
                <div class="col-4">
                    <label for="">Pavadinimas</label>
                    <input 
                    type="text" 
                    id="title"
                    name="title"
                    class="form-control">
                </div>
                <div class="col-4">
                    <label for="">Kaina</label>
                    <input 
                    type="text" 
                    id="price"
                    name="price"
                    class="form-control">
                </div>
                <div class="col-4">
                    <label for="">Kiekis</label>
                    <input 
                    type="text" 
                    id="stock"
                    name="stock" 
                    class="form-control">
                </div>
                <div class="col-4 mt-2">
                    <label for="">Prekinis zenklas</label>
                    <input 
                    type="text" 
                    id="brand"
                    name="brand" 
                    class="form-control">
                </div>
                <div class="col-4 mt-2">
                    <label for="category">Kategorija</label>
                    <select name="category" id="category" class="form-select">
                        <option value="">smartphones</option>
                        <option value="">laptops</option>
                        <option value="">fragrances</option>
                        <option value="">skincare</option>
                        <option value="">groceries</option>
                        <option value="">home-decoration</option>
                    </select>
                </div>
                <div class="col-4 mt-2">
                    <label for="imageUrl">Nuotrauka:</label>
                    <input 
                    type="text" 
                    id="imageUrl"
                    name="imageUrl" 
                    class="form-control">
                </div>
                <div class="col-4 mt-2">
                    <label for="discount">Nulaida:</label>
                    <input 
                    type="number" 
                    min="0"
                    max="100"
                    value="0"
                    id="discount"
                    name="discount" 
                    class="form-control">
                </div>
                <div class="col-4 mt-2">
                    <label for="rating">ivertinimas</label>
                    <input 
                    type="number" 
                    min="0"
                    max="5"
                    value="0"
                    id="rating"
                    name="rating" 
                    class="form-control">
                </div>
                <div class="col-4 mt-2">
                    <label for="description">description</label>
                    <textarea name="description" id="description" class="form-control"></textarea>
                </div>
                <div class="col-4 mt-2">
                    <button 
                        class="btn btn-primary mt-4" 
                        id="submit">Submit
                    </button>
                </div>
            </div>
        </form>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Prekes pavadinimas</th>
                    <th>Kaina</th>
                    <th>Kiekis</th>
                    <th>Prekinis zenklas</th>
                    <th>Kategorija</th>
                    <th>Istrynimas</th>
                    <th>Atnaujinimas</th>
                </tr>
            </thead>
            <tbody id="dynamic-data">
                <tr>
                    <td>1</td>
                    <td>Apple produkt</td>
                    <td>1.50</td>
                    <td>1</td>
                    <td>Apple</td>
                    <td>Maistas</td>
                </tr>
            </tbody>
        </table>
    </div>
        <dialog 
        
        id="productInfo"
        style="width: 70%;">
        <div style="max-width: 70%;margin: 0 auto;">
            <img src="https://i.dummyjson.com/data/products/1/thumbnail.jpg" 
            alt="product photo">
            <div class="product-details">
                    <div class="row">
                        <span class="col-2 fw-bold">Nuolaida</span>
                        <span class="col-1">10%</span>
                    </div>
                    <div class="row">
                        <span class="col-2 fw-bold">ivertinimas</span>
                        <span class="col-1">4.23</span>
                    </div>
                    <div class="row">
                        <span class="col-2 fw-bold">Aprasimas</span>
                        <span class="col-6">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Necessitatibus a nesciunt laborum ut, repellendus aperiam incidunt nemo, itaque quae dolorem provident tenetur rerum veritatis ipsum! Impedit odit quisquam maxime nam perferendis, dolorem maiores aperiam, debitis incidunt vero mollitia eaque minima!</span>
                    </div>
                    </div>
            </div>
        </dialog>


    <script>
        //CRUD:
        // CREATE -sukurti irasa good
        // READ - Perziureti irasa good
        //UPDATE - Atnaujinti irasa
        // DELETE - istrinti irasa good
        console.log(localStorage.getItem("products"));
        if(!localStorage.getItem("products")){
            console.log("pirmas kartas");
            localStorage.setItem('products',"[]")
        }
        const products = JSON.parse(localStorage.getItem('products'));
        
        if (!localStorage.getItem("currentId")){
            localStorage.setItem("currentId","1")
        }
        let curretntId = +localStorage.getItem("currentId");
        let editMode = false;
        let currentProduct;

        const dynamicDataElement = document.getElementById("dynamic-data"),titleInputElement = document.getElementById('title'),
        priceInputElement = document.getElementById('price'),
        stockInputElement = document.getElementById('stock'),
        brandInputElement = document.getElementById('brand'),
        categoryInputElement = document.getElementById('category'),
        submitButtonElement = document.getElementById('submit'),
        modalElement = document.getElementById("productInfo"),
        photoElement = document.getElementById("imageUrl"),
        discountElement = document.getElementById("discount"),
        ratingElement = document.getElementById("rating"),
        descriptionElement = document.getElementById('description');


        //Automatinis funkcijos iskvietimas apskliaudus funkcija  ir  uz  jos padejus skliaustelius
        const getTableContents = () =>{
            let dynamicHTML= ``;

            for (const product of products)
            {
                dynamicHTML +=`<tr>
                    <td onclick="showModal(${product.id})">${product.id}</td>
                    <td>${product.title}</td>
                    <td>${product.price}</td>
                    <td>${product.stock}</td>
                    <td>${product.brand}</td>
                    <td>${product.category}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteProduct(${product.id})">Istrinti</button>
                        </td>
                    <td>
                        <button class="btn btn-success" onclick="setEdit(${product.id})">Atnaujinti</button>
                        </td>
                </tr>`;
            }
            dynamicDataElement.innerHTML = dynamicHTML;
        };
        getTableContents();

        const showModal= (id)=> {
            let elementIndex = products.findIndex(value=>value.id===id);
            const product=products[elementIndex]
            let dynamicHTML = `<div id="modalBody" style="width:100%; height:100%"> <div style="max-width: 70%;margin: 0 auto; padding: .5rem;">
            <img src="${product.thumbnail}" 
            alt="product photo">
            <div class="product-details">
                    <div class="row">
                        <span class="col-lg-2 fw-bold">Nuolaida</span>
                        <span class="col-lg-1">-${product.discountPercentage}</span>
                    </div>
                    <div class="row">
                        <span class="col-lg-2 fw-bold">ivertinimas</span>
                        <span class="col-lg-1">${product.rating}3</span>
                    </div>
                    <div class="row">
                        <span class="col-lg-2 fw-bold">Aprasimas</span>
                        <span class="col-10">${product.description}</span>
                    </div>
                    </div>
                    <button class="btn btn-danger mt-3 onclick="modalElement.close()">Uzdaryti</button>
            </div></div>`
            modalElement.innerHTML=dynamicHTML
            document.querySelector("#modalBody").onclick = (event)=>{
                event.stopPropagation();
                console.log("Clicked on modal winddow")
            }
            modalElement.showModal();
        }
        modalElement.onclick=()=>{
            modalElement.close()
        }
        
        const createNewRecord = (event) =>{
            //prevencija nuo iprastinio elgesio,
            event.preventDefault();
            const newProduct ={
                id: curretntId,
                title: titleInputElement.value,
                description: descriptionElement.value,
                price: +priceInputElement.value,
                discountPercentage: +discountElement.value,
                rating:+ratingElement.value,
                stock: +stockInputElement.value,
                brand: brandInputElement.value,
                category: categoryInputElement.value,
                thumbnail: photoElement.value,
            };
            curretntId++;
            products.push(newProduct);
            localStorage.setItem('products',JSON.stringify(products));
            localStorage.setItem("cerrentId", curretntId);

            getTableContents();
        };
        submitButtonElement.onclick = createNewRecord;

        //elementu istrynimas
        const deleteProduct = (id) =>{
            let elementIndex = products.findIndex(value=>value.id===id);
            products.splice(elementIndex,1);
            getTableContents();
            localStorage.setItem("products".JSON.stringify(products))
        };
        
        const updateProduct=(event)=>{
            event.preventDefault();
            console.log('veikiu!');
            products[currentProduct].title=titleInputElement.value;
            products[currentProduct].price=priceInputElement.value;
            products[currentProduct].stock=stockInputElement.value;
            products[currentProduct].brand=brandInputElement.value;
            products[currentProduct].category=categoryInputElement.value;
            products[currentProduct].thumbnail=photoElement.value;
            products[currentProduct].rating=ratingElement.value;
            products[currentProduct].discountPercentage=discountElement.value;
            products[currentProduct].description=descriptionElement.value;

            getTableContents();
            currentProduct = undefined;
            editMode=false;
            submitButtonElement.onclick = createNewRecord;
            submitButtonElement.innerText = "submit";
            submitButtonElement.classList.remove("btn-success");
            submitButtonElement.classList.add("btn-primary");

            titleInputElement.value = "";
            priceInputElement.value = "";
            stockInputElement.value = "";
            brandInputElement.value = "";
            categoryInputElement.value = "";
            photoElement.value = "";
            ratingElement.value = "";
            discountElement.value = "";
            descriptionElement.value = "";
            localStorage.setItem("products".JSON.stringify(products))
        


        };

    //elemento atnaujinimas
        const setEdit = (id) =>{
            let elementIndex = products.findIndex(value=>value.id===id);
            const product= products[elementIndex];
            //inputu uzpildimas
            titleInputElement.value = product.title;
            priceInputElement.value = product.price;
            stockInputElement.value = product.stock;
            brandInputElement.value = product.brand;
            categoryInputElement.value = product.category;
            photoElement.value = product.thumbnail;
            ratingElement.value = product.rating;
            discountElement.value = product.discountPercentage;
            descriptionElement.value = product.description;

            submitButtonElement.innerText = "Update";
            submitButtonElement.classList.add("btn-success");
            submitButtonElement.classList.add("btn-primary");
            submitButtonElement.onclick=updateProduct;
            currentProduct = elementIndex;
            editMode = true;
        };
        
    </script>
</body>
</html>